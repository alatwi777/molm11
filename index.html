<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¹Ù„Ù… - Ù…Ø¹ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* === Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© === */
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3a1;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* === Ø§Ù„Ù‡ÙŠØ¯Ø± === */
        header {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            text-align: center;
            border-right: 5px solid var(--primary-color);
        }
        
        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .sync-status {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .online {
            color: #28a745;
            border-right: 4px solid #28a745;
        }
        
        .offline {
            color: #dc3545;
            border-right: 4px solid #dc3545;
        }
        
        /* === Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª === */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: var(--light-color);
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* === Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª === */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* === Ø§Ù„ÙƒØ±ÙˆØª === */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary-color);
        }
        
        .card h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        /* === Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ === */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        /* === Ø§Ù„Ø£Ø²Ø±Ø§Ø± === */
        .btn-primary {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.2);
        }
        
        .btn-secondary {
            background: var(--light-color);
            color: var(--dark-color);
            border: 2px solid #ddd;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            border-color: var(--primary-color);
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: #e11d48;
            transform: translateY(-2px);
        }
        
        /* === Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ === */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        table th {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: bold;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        table tr:last-child td {
            border-bottom: none;
        }
        
        /* === Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµØºÙŠØ±Ø© === */
        .btn-edit, .btn-delete {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 3px;
            font-size: 0.9rem;
        }
        
        .btn-edit {
            background: var(--accent-color);
            color: white;
        }
        
        .btn-delete {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-edit:hover, .btn-delete:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        /* === Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª === */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            border-right: 4px solid var(--primary-color);
        }
        
        .stat-icon {
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-info h3 {
            margin: 0;
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .stat-info p {
            margin: 5px 0 0 0;
            color: #666;
        }
        
        /* === Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© === */
        .sync-container {
            display: grid;
            gap: 20px;
        }
        
        .sync-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .sync-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .sync-header i {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 50%;
        }
        
        .sync-body {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--border-radius);
        }
        
        .sync-status p {
            margin: 10px 0;
            font-size: 1.1rem;
        }
        
        .online-status {
            color: #4ade80;
            font-weight: bold;
        }
        
        .offline-status {
            color: #f87171;
            font-weight: bold;
        }
        
        .sync-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .sync-instructions {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .sync-instructions ol {
            padding-right: 20px;
            margin: 15px 0;
        }
        
        .sync-instructions li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        /* === Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ === */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-right: 4px solid #10b981;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-right: 4px solid #f59e0b;
        }
        
        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border-right: 4px solid #ef4444;
        }
        
        /* === Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© === */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
                justify-content: center;
            }
            
            .sync-actions {
                flex-direction: column;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
        }
        
        /* === ØªØ­Ù…ÙŠÙ„ === */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading i {
            font-size: 2rem;
            color: var(--primary-color);
        }
    </style>
    
    <!-- Ù…ÙƒØªØ¨Ø© Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chalkboard-teacher"></i> Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¹Ù„Ù…</h1>
            <div class="sync-status" id="syncStatus">
                <i class="fas fa-sync-alt fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
            </div>
            <p id="currentDate"></p>
        </header>
        
        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="students"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button class="tab-btn" data-tab="excel"><i class="fas fa-file-excel"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ø¥ÙƒØ³Ù„</button>
            <button class="tab-btn" data-tab="tests"><i class="fas fa-file-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <button class="tab-btn" data-tab="results"><i class="fas fa-chart-bar"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <button class="tab-btn" data-tab="sync"><i class="fas fa-cloud"></i> Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</button>
        </nav>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
        <div class="tab-content active" id="students">
            <div class="card">
                <h2><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <div class="form-group">
                    <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                    <input type="text" id="studentName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
                </div>
                
                <div class="form-group">
                    <label for="studentClass">Ø§Ù„ØµÙ:</label>
                    <input type="text" id="studentClass" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø§Ø¯Ø³ Ø£">
                </div>
                
                <div class="form-group">
                    <label for="studentId">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</label>
                    <input type="text" id="studentId" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
                </div>
                
                <div class="form-group">
                    <label for="seatNumber">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³:</label>
                    <input type="text" id="seatNumber" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³">
                </div>
                
                <button class="btn-primary" onclick="addStudent()">
                    <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
                </button>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <div id="studentsTable"></div>
                <div class="sync-actions">
                    <button class="btn-primary" onclick="exportStudentsToExcel()">
                        <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel -->
        <div class="tab-content" id="excel">
            <div class="card">
                <h2><i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Ù…Ù„Ù Excel</h2>
                <div class="form-group">
                    <label for="excelFile">Ø§Ø®ØªØ± Ù…Ù„Ù Excel:</label>
                    <input type="file" id="excelFile" class="form-control" accept=".xlsx, .xls, .csv">
                    <small>ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØµÙØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</small>
                </div>
                
                <button class="btn-primary" onclick="document.getElementById('excelFile').click()">
                    <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
                </button>
                
                <div id="importResult"></div>
                <div class="loading" id="importLoading">
                    <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-file-download"></i> ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Excel</h2>
                <p>Ù‚Ù… Ø¨ØªÙ†Ø²ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ù…Ù„Ø£Ù‡ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ØŒ Ø«Ù… Ù‚Ù… Ø¨Ø±ÙØ¹Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                <button class="btn-primary" onclick="downloadExcelTemplate()">
                    <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                </button>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
        <div class="tab-content" id="tests">
            <div class="card">
                <h2><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>
                <div class="form-group">
                    <label for="testName">Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
                    <input type="text" id="testName" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„">
                </div>
                
                <div class="form-group">
                    <label for="testSubject">Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                    <input type="text" id="testSubject" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">
                </div>
                
                <div class="form-group">
                    <label for="testDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
                    <input type="date" id="testDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="testTotalScore">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©:</label>
                    <input type="number" id="testTotalScore" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 100">
                </div>
                
                <div class="form-group">
                    <label for="testQuestionsCount">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</label>
                    <input type="number" id="testQuestionsCount" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 20">
                </div>
                
                <button class="btn-primary" onclick="addTest()">
                    <i class="fas fa-file-alt"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±
                </button>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-list-alt"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h2>
                <div id="testsTable"></div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="tab-content" id="results">
            <div class="card">
                <h2><i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
                <div id="resultsSummary"></div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-filter"></i> ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
                <div class="form-group">
                    <label for="testFilter">Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±:</label>
                    <select id="testFilter" class="form-control">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</option>
                    </select>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-table"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</th>
                            <th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                            <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                    </tbody>
                </table>
                
                <div class="sync-actions">
                    <button class="btn-primary" onclick="exportResultsToExcel()">
                        <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    </button>
                    <button class="btn-secondary" onclick="generateReport()">
                        <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                    </button>
                </div>
                
                <div id="reportOutput"></div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div class="tab-content" id="sync">
            <div class="card">
                <h2><i class="fas fa-cloud-upload-alt"></i> Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</h2>
                <p class="subtitle">Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø²</p>
                
                <div class="sync-container">
                    <div class="sync-card">
                        <div class="sync-header">
                            <i class="fas fa-cloud"></i>
                            <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h3>
                        </div>
                        <div class="sync-body">
                            <div class="sync-status" id="syncDetails">
                                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span id="syncState">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></p>
                                <p><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> <span id="lastUpdate">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</span></p>
                                <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</strong> <span id="studentCount">0</span></p>
                                <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:</strong> <span id="testCount">0</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sync-actions">
                        <button onclick="manualSync()" class="btn-primary" id="syncBtn">
                            <i class="fas fa-sync-alt"></i> Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¢Ù†
                        </button>
                        <button onclick="checkSyncStatus()" class="btn-secondary">
                            <i class="fas fa-redo"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                        </button>
                    </div>
                    
                    <div class="sync-instructions">
                        <h4><i class="fas fa-info-circle"></i> ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:</h4>
                        <ol>
                            <li>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªØ®Ø²Ù† Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ</li>
                            <li>Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©ØŒ ØªØ±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Firebase)</li>
                            <li>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø²</li>
                            <li>Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase =====
        // ğŸ”¥ Ø¶Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡Ù†Ø§ ğŸ”¥
        const firebaseConfig = {
            apiKey: "AIzaSyB_ZgwQhrIulXfbkR7tvPYqJjuUtMSuIX8",
            authDomain: "alhosin-2be4c.firebaseapp.com",
            projectId: "alhosin-2be4c",
            storageBucket: "alhosin-2be4c.firebasestorage.app",
            messagingSenderId: "13131661059",
            appId: "1:13131661059:web:bb3e7419e573e4c66ff336"
        };
        
        // ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =====
        let db;
        let isOnline = false;
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let tests = JSON.parse(localStorage.getItem('tests')) || [];
        let results = JSON.parse(localStorage.getItem('results')) || [];
        
        // ===== ØªÙ‡ÙŠØ¦Ø© Firebase =====
        async function initFirebase() {
            try {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Firebase...');
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                await db.collection('connectionTest').doc('test').set({
                    timestamp: new Date(),
                    status: 'connected'
                });
                
                isOnline = true;
                updateSyncStatus(true, 'âœ“ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                console.log('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase Ø¨Ù†Ø¬Ø§Ø­');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                await loadFromCloud();
                
            } catch (error) {
                console.log('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
                console.error('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error);
                isOnline = false;
                updateSyncStatus(false, 'âœ— ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ');
            }
        }
        
        // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© =====
        function updateSyncStatus(online, message) {
            const statusDiv = document.getElementById('syncStatus');
            if (statusDiv) {
                statusDiv.innerHTML = `<i class="fas fa-${online ? 'cloud' : 'wifi'}"></i> ${message}`;
                statusDiv.className = `sync-status ${online ? 'online' : 'offline'}`;
            }
            isOnline = online;
        }
        
        async function saveToCloud(dataType, data) {
            if (!isOnline) return false;
            
            try {
                await db.collection('schoolData').doc(dataType).set({
                    data: data,
                    lastUpdated: new Date(),
                    updatedBy: 'teacher'
                });
                console.log(`âœ… ØªÙ… Ø­ÙØ¸ ${dataType} ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`);
                return true;
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ ${dataType}:`, error);
                return false;
            }
        }
        
        async function loadFromCloud() {
            if (!isOnline) return;
            
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨
                const studentsDoc = await db.collection('schoolData').doc('students').get();
                if (studentsDoc.exists) {
                    const cloudStudents = studentsDoc.data().data || [];
                    if (cloudStudents.length > 0) {
                        students = cloudStudents;
                        localStorage.setItem('students', JSON.stringify(students));
                        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    }
                }
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                const testsDoc = await db.collection('schoolData').doc('tests').get();
                if (testsDoc.exists) {
                    const cloudTests = testsDoc.data().data || [];
                    if (cloudTests.length > 0) {
                        tests = cloudTests;
                        localStorage.setItem('tests', JSON.stringify(tests));
                        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    }
                }
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                const resultsDoc = await db.collection('schoolData').doc('results').get();
                if (resultsDoc.exists) {
                    const cloudResults = resultsDoc.data().data || [];
                    if (cloudResults.length > 0) {
                        results = cloudResults;
                        localStorage.setItem('results', JSON.stringify(results));
                        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    }
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
        }
        
        async function manualSync() {
            const syncBtn = document.getElementById('syncBtn');
            const originalText = syncBtn.innerHTML;
            
            syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
            syncBtn.disabled = true;
            
            try {
                if (isOnline) {
                    await saveToCloud('students', students);
                    await saveToCloud('tests', tests);
                    await saveToCloud('results', results);
                    
                    alert('âœ… ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                    checkSyncStatus();
                } else {
                    alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
                alert('âŒ ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ' + error.message);
            } finally {
                syncBtn.innerHTML = originalText;
                syncBtn.disabled = false;
            }
        }
        
        function checkSyncStatus() {
            const syncState = document.getElementById('syncState');
            const studentCount = document.getElementById('studentCount');
            const testCount = document.getElementById('testCount');
            const lastUpdate = document.getElementById('lastUpdate');
            
            if (isOnline) {
                syncState.textContent = 'Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©';
                syncState.className = 'online-status';
            } else {
                syncState.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ - ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠ';
                syncState.className = 'offline-status';
            }
            
            studentCount.textContent = students.length;
            testCount.textContent = tests.length;
            lastUpdate.textContent = new Date().toLocaleString('ar-SA');
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ =====
        function displayStudents() {
            const studentsTable = document.getElementById('studentsTable');
            if (!studentsTable) return;
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ØµÙ</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (students.length === 0) {
                html += `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            <i class="fas fa-users-slash"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ†
                        </td>
                    </tr>
                `;
            } else {
                students.forEach((student, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${student.name}</td>
                            <td>${student.class}</td>
                            <td>${student.id}</td>
                            <td>${student.seatNumber}</td>
                            <td>
                                <button onclick="editStudent(${index})" class="btn-edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteStudent(${index})" class="btn-delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            html += `
                    </tbody>
                </table>
                <div class="summary">
                    <p><i class="fas fa-users"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨: ${students.length}</p>
                </div>
            `;
            
            studentsTable.innerHTML = html;
        }
        
        function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value.trim();
            const studentId = document.getElementById('studentId').value.trim();
            const seatNumber = document.getElementById('seatNumber').value.trim();
            
            if (!name || !studentClass || !studentId || !seatNumber) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            const newStudent = {
                name,
                class: studentClass,
                id: studentId,
                seatNumber,
                createdAt: new Date().toISOString()
            };
            
            students.push(newStudent);
            saveStudentsLocally();
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('studentName').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('studentId').value = '';
            document.getElementById('seatNumber').value = '';
            
            displayStudents();
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        async function saveStudentsLocally() {
            localStorage.setItem('students', JSON.stringify(students));
            
            if (isOnline) {
                await saveToCloud('students', students);
            }
        }
        
        async function deleteStudent(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) {
                students.splice(index, 1);
                await saveStudentsLocally();
                displayStudents();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            }
        }
        
        function editStudent(index) {
            const student = students[index];
            
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentId').value = student.id;
            document.getElementById('seatNumber').value = student.seatNumber;
            
            // ØªØºÙŠÙŠØ± Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ«
            const addBtn = document.querySelector('#students .btn-primary');
            addBtn.innerHTML = '<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§Ù„Ø¨';
            addBtn.onclick = function() { updateStudent(index); };
        }
        
        async function updateStudent(index) {
            const name = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value.trim();
            const studentId = document.getElementById('studentId').value.trim();
            const seatNumber = document.getElementById('seatNumber').value.trim();
            
            if (!name || !studentClass || !studentId || !seatNumber) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            students[index] = {
                ...students[index],
                name,
                class: studentClass,
                id: studentId,
                seatNumber,
                updatedAt: new Date().toISOString()
            };
            
            await saveStudentsLocally();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('studentName').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('studentId').value = '';
            document.getElementById('seatNumber').value = '';
            
            const addBtn = document.querySelector('#students .btn-primary');
            addBtn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨';
            addBtn.onclick = addStudent;
            
            displayStudents();
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function exportStudentsToExcel() {
            if (students.length === 0) {
                alert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù„ØªØµØ¯ÙŠØ±Ù‡Ù…');
                return;
            }
            
            let csv = 'Ø§Ù„Ø§Ø³Ù…,Ø§Ù„ØµÙ,Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©,Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³\n';
            
            students.forEach(student => {
                csv += `${student.name},${student.class},${student.id},${student.seatNumber}\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Ø§Ù„Ø·Ù„Ø§Ø¨_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª =====
        function displayTests() {
            const testsTable = document.getElementById('testsTable');
            if (!testsTable) return;
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (tests.length === 0) {
                html += `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            <i class="fas fa-file-alt"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø©
                        </td>
                    </tr>
                `;
            } else {
                tests.forEach((test, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${test.name}</td>
                            <td>${test.subject}</td>
                            <td>${test.date}</td>
                            <td>${test.totalScore}</td>
                            <td>${test.questionsCount}</td>
                            <td>
                                <button onclick="editTest(${index})" class="btn-edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTest(${index})" class="btn-delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button onclick="enterTestResults(${index})" class="btn-primary">
                                    <i class="fas fa-keyboard"></i> Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            html += `
                    </tbody>
                </table>
                <div class="summary">
                    <p><i class="fas fa-file-alt"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: ${tests.length}</p>
                </div>
            `;
            
            testsTable.innerHTML = html;
        }
        
        function addTest() {
            const name = document.getElementById('testName').value.trim();
            const subject = document.getElementById('testSubject').value.trim();
            const date = document.getElementById('testDate').value;
            const totalScore = document.getElementById('testTotalScore').value;
            const questionsCount = document.getElementById('testQuestionsCount').value;
            
            if (!name || !subject || !date || !totalScore || !questionsCount) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            const newTest = {
                id: Date.now(),
                name,
                subject,
                date,
                totalScore: parseInt(totalScore),
                questionsCount: parseInt(questionsCount),
                createdAt: new Date().toISOString()
            };
            
            tests.push(newTest);
            saveTestsLocally();
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('testName').value = '';
            document.getElementById('testSubject').value = '';
            document.getElementById('testDate').value = '';
            document.getElementById('testTotalScore').value = '';
            document.getElementById('testQuestionsCount').value = '';
            
            displayTests();
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        async function saveTestsLocally() {
            localStorage.setItem('tests', JSON.stringify(tests));
            
            if (isOnline) {
                await saveToCloud('tests', tests);
            }
        }
        
        async function deleteTest(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ')) {
                tests.splice(index, 1);
                await saveTestsLocally();
                displayTests();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
            }
        }
        
        function editTest(index) {
            const test = tests[index];
            
            document.getElementById('testName').value = test.name;
            document.getElementById('testSubject').value = test.subject;
            document.getElementById('testDate').value = test.date;
            document.getElementById('testTotalScore').value = test.totalScore;
            document.getElementById('testQuestionsCount').value = test.questionsCount;
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø±
            const addBtn = document.querySelector('#tests .btn-primary');
            addBtn.innerHTML = '<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
            addBtn.onclick = function() { updateTest(index); };
        }
        
        async function updateTest(index) {
            const name = document.getElementById('testName').value.trim();
            const subject = document.getElementById('testSubject').value.trim();
            const date = document.getElementById('testDate').value;
            const totalScore = document.getElementById('testTotalScore').value;
            const questionsCount = document.getElementById('testQuestionsCount').value;
            
            if (!name || !subject || !date || !totalScore || !questionsCount) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            tests[index] = {
                ...tests[index],
                name,
                subject,
                date,
                totalScore: parseInt(totalScore),
                questionsCount: parseInt(questionsCount),
                updatedAt: new Date().toISOString()
            };
            
            await saveTestsLocally();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('testName').value = '';
            document.getElementById('testSubject').value = '';
            document.getElementById('testDate').value = '';
            document.getElementById('testTotalScore').value = '';
            document.getElementById('testQuestionsCount').value = '';
            
            const addBtn = document.querySelector('#tests .btn-primary');
            addBtn.innerHTML = '<i class="fas fa-file-alt"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±';
            addBtn.onclick = addTest;
            
            displayTests();
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function enterTestResults(testIndex) {
            const test = tests[testIndex];
            
            if (students.length === 0) {
                alert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù‡Ù…');
                return;
            }
            
            let html = `
                <div class="results-entry">
                    <h3><i class="fas fa-keyboard"></i> Ø¥Ø¯Ø®Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø±: ${test.name}</h3>
                    <p>Ø§Ù„Ù…Ø§Ø¯Ø©: ${test.subject} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${test.date} | Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©: ${test.totalScore}</p>
                    
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</th>
                                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            students.forEach((student, index) => {
                html += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.seatNumber}</td>
                        <td>
                            <input type="number" 
                                   id="score_${index}" 
                                   min="0" 
                                   max="${test.totalScore}"
                                   placeholder="0-${test.totalScore}"
                                   onchange="calculatePercentage(${index}, ${test.totalScore})">
                        </td>
                        <td>
                            <span id="percentage_${index}">0%</span>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    
                    <div class="sync-actions">
                        <button onclick="saveTestResults(${testIndex})" class="btn-primary">
                            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        </button>
                        <button onclick="displayTests()" class="btn-secondary">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            const testsTable = document.getElementById('testsTable');
            if (testsTable) {
                testsTable.innerHTML = html;
            }
        }
        
        function calculatePercentage(index, totalScore) {
            const scoreInput = document.getElementById(`score_${index}`);
            const percentageSpan = document.getElementById(`percentage_${index}`);
            
            if (scoreInput && percentageSpan) {
                const score = parseFloat(scoreInput.value) || 0;
                const percentage = totalScore > 0 ? ((score / totalScore) * 100).toFixed(1) : 0;
                percentageSpan.textContent = `${percentage}%`;
            }
        }
        
        async function saveTestResults(testIndex) {
            const test = tests[testIndex];
            const newResults = [];
            let hasResults = false;
            
            for (let i = 0; i < students.length; i++) {
                const scoreInput = document.getElementById(`score_${i}`);
                const score = scoreInput ? parseFloat(scoreInput.value) : null;
                
                if (score !== null && !isNaN(score)) {
                    newResults.push({
                        studentId: students[i].id,
                        studentName: students[i].name,
                        seatNumber: students[i].seatNumber,
                        testId: test.id,
                        testName: test.name,
                        score: score,
                        percentage: ((score / test.totalScore) * 100).toFixed(1),
                        date: test.date
                    });
                    hasResults = true;
                }
            }
            
            if (!hasResults) {
                alert('âŒ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ù†ØªØ§Ø¦Ø¬');
                return;
            }
            
            // Ø¯Ù…Ø¬ Ù…Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const filteredResults = results.filter(r => r.testId !== test.id);
            results = [...filteredResults, ...newResults];
            
            localStorage.setItem('results', JSON.stringify(results));
            
            if (isOnline) {
                await saveToCloud('results', results);
            }
            
            alert(`âœ… ØªÙ… Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ ${newResults.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`);
            displayTests();
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ =====
        function displayResultsSummary() {
            const summaryElement = document.getElementById('resultsSummary');
            if (!summaryElement) return;
            
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${students.length}</h3>
                            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${tests.length}</h3>
                            <p>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${results.length}</h3>
                            <p>Ø³Ø¬Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${calculateAverageScore()}%</h3>
                            <p>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                        </div>
                    </div>
                </div>
            `;
            
            summaryElement.innerHTML = html;
        }
        
        function loadResultsData() {
            const testSelect = document.getElementById('testFilter');
            if (testSelect) {
                testSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</option>';
                
                tests.forEach(test => {
                    const option = document.createElement('option');
                    option.value = test.id;
                    option.textContent = `${test.name} (${test.date})`;
                    testSelect.appendChild(option);
                });
                
                testSelect.addEventListener('change', filterResults);
            }
            
            displayAllResults();
        }
        
        function displayAllResults() {
            const tableBody = document.getElementById('resultsTableBody');
            if (!tableBody) return;
            
            if (results.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <i class="fas fa-chart-bar"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø³Ø¬Ù„Ø©
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            results.forEach((result, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${result.studentName}</td>
                        <td>${result.seatNumber}</td>
                        <td>${result.testName}</td>
                        <td>${result.score}</td>
                        <td>${result.percentage}%</td>
                        <td>${result.date}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }
        
        function filterResults() {
            const testSelect = document.getElementById('testFilter');
            const testId = testSelect.value;
            
            if (!testId) {
                displayAllResults();
                return;
            }
            
            const filteredResults = results.filter(result => result.testId == testId);
            const tableBody = document.getElementById('resultsTableBody');
            
            if (filteredResults.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <i class="fas fa-chart-bar"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredResults.forEach((result, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${result.studentName}</td>
                        <td>${result.seatNumber}</td>
                        <td>${result.testName}</td>
                        <td>${result.score}</td>
                        <td>${result.percentage}%</td>
                        <td>${result.date}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }
        
        function calculateAverageScore() {
            if (results.length === 0) return 0;
            
            const total = results.reduce((sum, result) => {
                return sum + parseFloat(result.percentage);
            }, 0);
            
            return (total / results.length).toFixed(1);
        }
        
        function exportResultsToExcel() {
            if (results.length === 0) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
                return;
            }
            
            const data = [
                ['Ø§Ù„Ø§Ø³Ù…', 'Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³', 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'Ø§Ù„Ø¯Ø±Ø¬Ø©', 'Ø§Ù„Ù†Ø³Ø¨Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®']
            ];
            
            results.forEach(result => {
                data.push([
                    result.studentName,
                    result.seatNumber,
                    result.testName,
                    result.score,
                    result.percentage + '%',
                    result.date
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
            
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª_${date}.xlsx`);
        }
        
        function generateReport() {
            let reportHTML = `
                <div class="report">
                    <h3><i class="fas fa-chart-pie"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</h3>
                    <div class="report-date">${new Date().toLocaleDateString('ar-SA')}</div>
                    
                    <div class="report-section">
                        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©:</h4>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: ${students.length}</p>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: ${tests.length}</p>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${results.length}</p>
                        <p>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${calculateAverageScore()}%</p>
                    </div>
            `;
            
            // ØªØ­Ù„ÙŠÙ„ Ù„ÙƒÙ„ Ø§Ø®ØªØ¨Ø§Ø±
            tests.forEach(test => {
                const testResults = results.filter(r => r.testId === test.id);
                if (testResults.length > 0) {
                    const scores = testResults.map(r => parseFloat(r.score));
                    const maxScore = Math.max(...scores);
                    const minScore = Math.min(...scores);
                    const avgScore = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1);
                    
                    reportHTML += `
                        <div class="test-report">
                            <h5>${test.name} (${test.date})</h5>
                            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: ${testResults.length}</p>
                            <p>Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø©: ${maxScore}/${test.totalScore}</p>
                            <p>Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø©: ${minScore}/${test.totalScore}</p>
                            <p>Ø§Ù„Ù…ØªÙˆØ³Ø·: ${avgScore}/${test.totalScore}</p>
                        </div>
                    `;
                }
            });
            
            reportHTML += `</div>`;
            
            const reportElement = document.getElementById('reportOutput');
            if (reportElement) {
                reportElement.innerHTML = reportHTML;
                
                // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                setTimeout(() => {
                    window.print();
                }, 500);
            }
        }
        
        // ===== Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel =====
        async function handleExcelImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const loading = document.getElementById('importLoading');
            if (loading) loading.style.display = 'block';
            
            try {
                const newStudents = await parseExcelFile(file);
                
                if (newStudents.length > 0) {
                    // Ø¯Ù…Ø¬ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
                    students = [...students, ...newStudents];
                    await saveStudentsLocally();
                    
                    displayStudents();
                    
                    const resultDiv = document.getElementById('importResult');
                    if (resultDiv) {
                        resultDiv.innerHTML = `
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i>
                                ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${newStudents.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­
                            </div>
                        `;
                    }
                    
                    checkSyncStatus();
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù:', error);
                alert('âŒ ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù: ' + error.message);
            } finally {
                if (loading) loading.style.display = 'none';
                event.target.value = '';
            }
        }
        
        async function parseExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        
                        const newStudents = [];
                        
                        for (let i = 1; i < jsonData.length; i++) {
                            const row = jsonData[i];
                            if (row && row.length >= 4) {
                                newStudents.push({
                                    name: row[0] || '',
                                    class: row[1] || '',
                                    id: row[2]?.toString() || '',
                                    seatNumber: row[3]?.toString() || '',
                                    createdAt: new Date().toISOString()
                                });
                            }
                        }
                        
                        resolve(newStudents);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        function downloadExcelTemplate() {
            const template = [
                ['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ØµÙ', 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³'],
                ['Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', 'Ø§Ù„Ø³Ø§Ø¯Ø³ Ø£', '123456', '1'],
                ['ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', 'Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¨', '123457', '2'],
                ['Ø®Ø§Ù„Ø¯ Ø³Ø¹Ø¯', 'Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø£', '123458', '3']
            ];
            
            const worksheet = XLSX.utils.aoa_to_sheet(template);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Ø§Ù„Ø·Ù„Ø§Ø¨');
            
            XLSX.writeFile(workbook, 'Ù†Ù…ÙˆØ°Ø¬_Ø§Ù„Ø·Ù„Ø§Ø¨.xlsx');
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª =====
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª Ø£ÙˆÙ„Ø§Ù‹
            tabContents.forEach(content => {
                content.style.display = 'none';
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„ÙƒÙ„ Ø²Ø±
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    tabBtns.forEach(b => b.classList.remove('active'));
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
                    tabContents.forEach(c => {
                        c.style.display = 'none';
                        c.classList.remove('active');
                    });
                    
                    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                    this.classList.add('active');
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
                    const targetTab = document.getElementById(tabId);
                    if (targetTab) {
                        targetTab.style.display = 'block';
                        targetTab.classList.add('active');
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„ ØªØ¨ÙˆÙŠØ¨ Ø¹Ù†Ø¯ ÙØªØ­Ù‡
                        switch(tabId) {
                            case 'students':
                                displayStudents();
                                break;
                            case 'tests':
                                displayTests();
                                break;
                            case 'results':
                                displayResultsSummary();
                                loadResultsData();
                                break;
                            case 'sync':
                                checkSyncStatus();
                                break;
                        }
                    }
                });
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø£ÙˆÙ„ ØªØ¨ÙˆÙŠØ¨
            if (tabBtns.length > 0) {
                tabBtns[0].click();
            }
        }
        
        // ===== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© =====
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ“„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            initTabs();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®
            const now = new Date();
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('ar-SA', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
            const fileInput = document.getElementById('excelFile');
            if (fileInput) {
                fileInput.addEventListener('change', handleExcelImport);
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Firebase
            await initFirebase();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            displayStudents();
            displayTests();
            displayResultsSummary();
            loadResultsData();
            
            console.log('âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
        });
        
        // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        window.addStudent = addStudent;
        window.editStudent = editStudent;
        window.deleteStudent = deleteStudent;
        window.exportStudentsToExcel = exportStudentsToExcel;
        window.addTest = addTest;
        window.editTest = editTest;
        window.deleteTest = deleteTest;
        window.enterTestResults = enterTestResults;
        window.calculatePercentage = calculatePercentage;
        window.saveTestResults = saveTestResults;
        window.filterResults = filterResults;
        window.exportResultsToExcel = exportResultsToExcel;
        window.generateReport = generateReport;
        window.manualSync = manualSync;
        window.checkSyncStatus = checkSyncStatus;
        window.downloadExcelTemplate = downloadExcelTemplate;
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงูุงุฎุชุจุงุฑุงุช - ููุญุฉ ุงููุนูู</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            margin: 0;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e6e 0%, #4a7dff 100%);
            color: white;
            padding: 25px;
            border-radius: 15px 15px 0 0;
            margin-bottom: 20px;
            text-align: center;
        }
        
        h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background-color: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 100, 0.1);
        }
        
        .tab {
            padding: 18px 30px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: #555;
        }
        
        .tab.active {
            color: #4a7dff;
            border-bottom: 3px solid #4a7dff;
            background-color: #f8fbff;
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 100, 0.08);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e6e;
            font-size: 17px;
        }
        
        input[type="text"], textarea, select, input[type="datetime-local"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e9f5;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s ease;
        }
        
        input[type="text"]:focus, textarea:focus, select:focus, input[type="datetime-local"]:focus {
            border-color: #4a7dff;
            outline: none;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }
        
        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .option-input span {
            font-weight: bold;
            color: #4a7dff;
            margin-left: 10px;
            min-width: 25px;
        }
        
        .correct-answer {
            margin-top: 20px;
            padding: 20px;
            background-color: #f0f7ff;
            border-radius: 8px;
            border-right: 4px solid #4a7dff;
        }
        
        .question-item {
            background-color: #f9fbff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e1e9f5;
            position: relative;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .question-number {
            background-color: #4a7dff;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .question-points {
            background-color: #2ecc71;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary {
            background-color: #4a7dff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a6def;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(58, 109, 239, 0.3);
        }
        
        .btn-secondary {
            background-color: #f0f7ff;
            color: #4a7dff;
            border: 2px solid #4a7dff;
        }
        
        .btn-secondary:hover {
            background-color: #e1edff;
        }
        
        .btn-danger {
            background-color: #ff6b6b;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #ff5252;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .students-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 100, 0.08);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .students-table th {
            background-color: #4a7dff;
            color: white;
            padding: 18px;
            text-align: right;
        }
        
        .students-table td {
            padding: 16px;
            border-bottom: 1px solid #eaeff5;
        }
        
        .students-table tr:hover {
            background-color: #f9fbff;
        }
        
        .student-score {
            font-weight: bold;
            font-size: 18px;
            color: #2c3e6e;
        }
        
        .student-pass {
            color: #2ecc71;
        }
        
        .student-fail {
            color: #e74c3c;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7b8ab8;
            font-size: 18px;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            display: block;
            color: #d1dbf9;
        }
        
        .test-link {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px dashed #b8d0ff;
            font-family: monospace;
            word-break: break-all;
            direction: ltr;
            text-align: center;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background-color: #2ecc71;
            color: white;
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
            display: none;
            z-index: 1000;
            text-align: center;
            font-weight: 600;
        }
        
        .notification.error {
            background-color: #e74c3c;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .notification.warning {
            background-color: #f39c12;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        
        .export-import {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .export-import textarea {
            font-family: monospace;
            min-height: 200px;
            direction: ltr;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .datetime-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .datetime-group > div {
            flex: 1;
        }
        
        .import-students {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px dashed #dee2e6;
        }
        
        .students-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #e1e9f5;
            border-radius: 8px;
            padding: 10px;
        }
        
        .student-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eaeff5;
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .datetime-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ูุธุงู ุงูุงุฎุชุจุงุฑุงุช ุงูุฅููุชุฑูููุฉ</h1>
            <div class="subtitle">ููุญุฉ ุชุญูู ุงููุนูู - ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช ูุงูุทูุงุจ</div>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="create-test">ุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ</div>
            <div class="tab" data-tab="import-students">ุฅุฏุงุฑุฉ ุงูุทูุงุจ</div>
            <div class="tab" data-tab="view-results">ูุชุงุฆุฌ ุงูุทูุงุจ</div>
            <div class="tab" data-tab="manage-tests">ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช</div>
        </div>
        
        <!-- ุชุจููุจ ุฅูุดุงุก ุงุฎุชุจุงุฑ -->
        <div id="create-test" class="tab-content active">
            <h2>ุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ</h2>
            
            <div class="form-group">
                <label for="test-title">ุนููุงู ุงูุงุฎุชุจุงุฑ:</label>
                <input type="text" id="test-title" placeholder="ุฃุฏุฎู ุนููุงู ุงูุงุฎุชุจุงุฑ (ูุซุงู: ุงุฎุชุจุงุฑ ุงููุตู ุงูุฃูู ูู ุงูุนููู)">
            </div>
            
            <div class="form-group">
                <label for="test-description">ูุตู ุงูุงุฎุชุจุงุฑ:</label>
                <textarea id="test-description" placeholder="ุฃุฏุฎู ูุตูุงู ููุงุฎุชุจุงุฑ (ุงุฎุชูุงุฑู)"></textarea>
            </div>
            
            <div class="form-group">
                <label>ุฃุณุฆูุฉ ุงูุงุฎุชุจุงุฑ:</label>
                <div id="questions-container">
                    <!-- ุณุชุชู ุฅุถุงูุฉ ุงูุฃุณุฆูุฉ ููุง ุฏููุงููููุงู -->
                </div>
                
                <div class="actions">
                    <button type="button" class="btn btn-primary" id="add-question">
                        <span>+ ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ</span>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label>ุฅุนุฏุงุฏุงุช ุงูุงุฎุชุจุงุฑ:</label>
                <div style="background-color: #f0f7ff; padding: 20px; border-radius: 10px;">
                    <div style="margin-bottom: 15px;">
                        <input type="checkbox" id="auto-correct" checked>
                        <label for="auto-correct" style="display: inline; margin-right: 10px;">ุงูุชุตุญูุญ ุงูุชููุงุฆู ุนูุฏ ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช</label>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="passing-score">ุฏุฑุฌุฉ ุงููุฌุงุญ (ุงููุณุจุฉ ุงููุฆููุฉ):</label>
                        <input type="number" id="passing-score" min="0" max="100" value="60" style="width: 100px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="max-attempts">ุนุฏุฏ ุงููุญุงููุงุช ุงููุณููุญุฉ ููู ุทุงูุจ:</label>
                        <select id="max-attempts" style="width: 150px;">
                            <option value="1">ูุฑุฉ ูุงุญุฏุฉ</option>
                            <option value="2" selected>ูุฑุชูู</option>
                        </select>
                        <p style="margin-top: 5px; font-size: 14px; color: #666;">ูููู ูููุนูู ููุญ ูุญุงููุงุช ุฅุถุงููุฉ ูุทุงูุจ ูุนูู ูู ุตูุญุฉ ุงููุชุงุฆุฌ</p>
                    </div>
                    
                    <div class="datetime-group">
                        <div>
                            <label for="start-date">ุชุงุฑูุฎ ูููุช ุจุฏุงูุฉ ุงูุงุฎุชุจุงุฑ:</label>
                            <input type="datetime-local" id="start-date">
                        </div>
                        <div>
                            <label for="end-date">ุชุงุฑูุฎ ูููุช ููุงูุฉ ุงูุงุฎุชุจุงุฑ:</label>
                            <input type="datetime-local" id="end-date">
                        </div>
                    </div>
                    <p style="margin-top: 5px; font-size: 14px; color: #666;">ุฅุฐุง ุชุฑูุช ุงูุญููู ูุงุฑุบุฉุ ุณูููู ุงูุงุฎุชุจุงุฑ ูุชุงุญุงู ุฏุงุฆูุงู</p>
                </div>
            </div>
            
            <div class="actions">
                <button type="button" class="btn btn-success" id="save-test">
                    <span>๐พ ุญูุธ ุงูุงุฎุชุจุงุฑ</span>
                </button>
                <button type="button" class="btn btn-secondary" id="preview-test">
                    <span>๐๏ธ ูุนุงููุฉ ุงูุงุฎุชุจุงุฑ</span>
                </button>
                <button type="button" class="btn btn-secondary" id="export-test">
                    <span>๐ฅ ุชุตุฏูุฑ ุงูุงุฎุชุจุงุฑ</span>
                </button>
                <button type="button" class="btn btn-secondary" id="import-test">
                    <span>๐ค ุงุณุชูุฑุงุฏ ุงุฎุชุจุงุฑ</span>
                </button>
            </div>
            
            <div id="test-link-container" style="display: none;">
                <h3>ุฑุงุจุท ุงุฎุชุจุงุฑ ุงูุทูุงุจ:</h3>
                <div class="test-link" id="test-link"></div>
                <p>ุงุฑุณู ูุฐุง ุงูุฑุงุจุท ููุทูุงุจ ูุจุฏุก ุงูุงุฎุชุจุงุฑ</p>
            </div>
        </div>
        
        <!-- ุชุจููุจ ุฅุฏุงุฑุฉ ุงูุทูุงุจ -->
        <div id="import-students" class="tab-content">
            <h2>ุฅุฏุงุฑุฉ ูุงุฆูุฉ ุงูุทูุงุจ</h2>
            
            <div class="import-students">
                <h3>ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ุงูุทูุงุจ ูู ููู Excel</h3>
                <p>ููููู ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ุงูุทูุงุจ ูู ููู CSV (ููู Excel). ูุฌุจ ุฃู ูุญุชูู ุงูููู ุนูู ุนููุฏูู: "ุฑูู ุงูุทุงูุจ" ู "ุงุณู ุงูุทุงูุจ".</p>
                
                <div class="actions">
                    <button type="button" class="btn btn-warning" id="import-students-btn">
                        <span>๐ ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ุงูุทูุงุจ (CSV)</span>
                    </button>
                    <button type="button" class="btn btn-primary" id="download-template">
                        <span>๐ ุชุญููู ูููุฐุฌ ููู CSV</span>
                    </button>
                </div>
                
                <div id="current-students" style="margin-top: 30px;">
                    <h4>ูุงุฆูุฉ ุงูุทูุงุจ ุงูุญุงููุฉ:</h4>
                    <div id="students-list-container">
                        <div class="empty-state" id="no-students">
                            <div>๐จโ๐</div>
                            <p>ูุง ุชูุฌุฏ ูุงุฆูุฉ ุทูุงุจ ูุณุชูุฑุฏุฉ</p>
                            <p>ุงุณุชูุฑุฏ ูุงุฆูุฉ ุงูุทูุงุจ ูู ููู CSV ูุนุฑุถูุง ููุง</p>
                        </div>
                        <div class="students-list" id="students-list" style="display: none;">
                            <!-- ุณุชุชู ุฅุถุงูุฉ ูุงุฆูุฉ ุงูุทูุงุจ ููุง -->
                        </div>
                    </div>
                </div>
                
                <div class="actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-danger" id="clear-students">
                        <span>๐๏ธ ุญุฐู ุฌููุน ุงูุทูุงุจ</span>
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 40px; background-color: #f9fbff; padding: 20px; border-radius: 10px;">
                <h4>ุชุนูููุงุช ุงุณุชูุฑุงุฏ ุงูุทูุงุจ:</h4>
                <ol style="line-height: 1.8;">
                    <li>ุงููุฑ ุนูู ุฒุฑ "ุชุญููู ูููุฐุฌ ููู CSV" ูุชุญููู ููู ุงููููุฐุฌ</li>
                    <li>ุงููุฃ ุงูููู ุจุฃุฑูุงู ูุฃุณูุงุก ุงูุทูุงุจ</li>
                    <li>ุงุญูุธ ุงูููู ุจุตูุบุฉ CSV</li>
                    <li>ุงููุฑ ุนูู ุฒุฑ "ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ุงูุทูุงุจ" ูุงุฎุชุฑ ุงูููู</li>
                    <li>ุณุชุธูุฑ ูุงุฆูุฉ ุงูุทูุงุจ ููุง ุจุนุฏ ุงูุงุณุชูุฑุงุฏ</li>
                </ol>
            </div>
        </div>
        
        <!-- ุชุจููุจ ูุชุงุฆุฌ ุงูุทูุงุจ -->
        <div id="view-results" class="tab-content">
            <h2>ูุชุงุฆุฌ ุงูุทูุงุจ</h2>
            
            <div id="results-container">
                <div class="empty-state" id="no-results">
                    <div>๐</div>
                    <p>ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุทูุงุจ ุจุนุฏ</p>
                    <p>ุจูุฌุฑุฏ ุฅุฑุณุงู ุงูุทูุงุจ ูุฅุฌุงุจุงุชููุ ุณุชุธูุฑ ุงููุชุงุฆุฌ ููุง</p>
                </div>
                
                <table class="students-table" id="results-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>ุงุณู ุงูุทุงูุจ</th>
                            <th>ุฑูู ุงูุณุฌู</th>
                            <th>ุงูุงุฎุชุจุงุฑ</th>
                            <th>ุงูุฏุฑุฌุฉ</th>
                            <th>ุงููุญุงููุงุช</th>
                            <th>ุงูุญุงูุฉ</th>
                            <th>ุชุงุฑูุฎ ุงูุฅุฑุณุงู</th>
                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody id="results-body">
                        <!-- ุณุชุชู ุฅุถุงูุฉ ูุชุงุฆุฌ ุงูุทูุงุจ ููุง -->
                    </tbody>
                </table>
            </div>
            
            <div class="actions" id="results-actions" style="display: none;">
                <button type="button" class="btn btn-primary" id="export-results">
                    <span>๐ ุชุตุฏูุฑ ุงููุชุงุฆุฌ (CSV)</span>
                </button>
                <button type="button" class="btn btn-danger" id="clear-results">
                    <span>๐๏ธ ุญุฐู ุฌููุน ุงููุชุงุฆุฌ</span>
                </button>
            </div>
        </div>
        
        <!-- ุชุจููุจ ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช -->
        <div id="manage-tests" class="tab-content">
            <h2>ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑุงุช ุงููุฎุฒูุฉ</h2>
            
            <div id="tests-list">
                <!-- ูุงุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช ุงููุฎุฒูุฉ -->
            </div>
            
            <div class="export-import">
                <div style="flex: 1;">
                    <h3>ุชุตุฏูุฑ ุฌููุน ุงูุจูุงูุงุช</h3>
                    <textarea id="export-data" readonly placeholder="ุณุชุธูุฑ ุจูุงูุงุช ุงูุชุตุฏูุฑ ููุง"></textarea>
                    <button type="button" class="btn btn-primary" id="generate-export">ุชูููุฏ ุจูุงูุงุช ุงูุชุตุฏูุฑ</button>
                </div>
                
                <div style="flex: 1;">
                    <h3>ุงุณุชูุฑุงุฏ ุจูุงูุงุช</h3>
                    <textarea id="import-data" placeholder="ุงูุตู ุจูุงูุงุช ุงูุงุณุชูุฑุงุฏ ููุง"></textarea>
                    <button type="button" class="btn btn-success" id="execute-import">ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช</button>
                </div>
            </div>
        </div>
        
        <div id="notification" class="notification"></div>
    </div>

    <!-- ูููุฐุฌ ุณุคุงู ูุงูุจ -->
    <template id="question-template">
        <div class="question-item" data-question-id="">
            <div class="question-header">
                <div class="question-number">1</div>
                <div class="question-points">1 ููุทุฉ</div>
            </div>
            
            <div class="form-group">
                <label>ูุต ุงูุณุคุงู:</label>
                <textarea class="question-text" placeholder="ุฃุฏุฎู ูุต ุงูุณุคุงู ููุง"></textarea>
            </div>
            
            <div class="form-group">
                <label>ุฎูุงุฑุงุช ุงูุฅุฌุงุจุฉ:</label>
                <div class="options-container">
                    <div class="option-input">
                        <span>ุฃ.</span>
                        <input type="text" class="option-a" placeholder="ุงููุต ุงูุฎูุงุฑ ุฃ">
                    </div>
                    <div class="option-input">
                        <span>ุจ.</span>
                        <input type="text" class="option-b" placeholder="ุงููุต ุงูุฎูุงุฑ ุจ">
                    </div>
                    <div class="option-input">
                        <span>ุฌ.</span>
                        <input type="text" class="option-c" placeholder="ุงููุต ุงูุฎูุงุฑ ุฌ">
                    </div>
                    <div class="option-input">
                        <span>ุฏ.</span>
                        <input type="text" class="option-d" placeholder="ุงููุต ุงูุฎูุงุฑ ุฏ">
                    </div>
                </div>
            </div>
            
            <div class="correct-answer">
                <label>ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ:</label>
                <select class="correct-option">
                    <option value="a">ุฃ</option>
                    <option value="b">ุจ</option>
                    <option value="c">ุฌ</option>
                    <option value="d">ุฏ</option>
                </select>
                
                <div style="margin-top: 15px;">
                    <label>ุฏุฑุฌุฉ ุงูุณุคุงู:</label>
                    <input type="number" class="question-points-input" min="1" max="10" value="1" style="width: 100px;">
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: left;">
                <button type="button" class="btn btn-danger delete-question">ุญุฐู ุงูุณุคุงู</button>
            </div>
        </div>
    </template>

    <script>
        // ูุชุบูุฑุงุช ุงููุธุงู
        let currentTest = null;
        let testResults = {};
        let savedTests = {};
        let studentsList = {};
        
        // ุชููุฆุฉ ุงููุธุงู ุนูุฏ ุงูุชุญููู
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            setupEventListeners();
            initializeTabs();
            addFirstQuestion();
            loadStudentsList();
            loadResults();
            loadTestsList();
        });
        
        // ุชุญููู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ
        function loadSavedData() {
            // ุชุญููู ุงูุงุฎุชุจุงุฑุงุช ุงููุฎุฒูุฉ
            const savedTestsData = localStorage.getItem('teacher_tests');
            if (savedTestsData) {
                savedTests = JSON.parse(savedTestsData);
            }
            
            // ุชุญููู ูุชุงุฆุฌ ุงูุทูุงุจ
            const savedResults = localStorage.getItem('test_results');
            if (savedResults) {
                testResults = JSON.parse(savedResults);
            }
            
            // ุชุญููู ูุงุฆูุฉ ุงูุทูุงุจ
            const savedStudents = localStorage.getItem('students_list');
            if (savedStudents) {
                studentsList = JSON.parse(savedStudents);
            }
        }
        
        // ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ
        function setupEventListeners() {
            // ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ
            document.getElementById('add-question').addEventListener('click', addQuestion);
            
            // ุญูุธ ุงูุงุฎุชุจุงุฑ
            document.getElementById('save-test').addEventListener('click', saveTest);
            
            // ูุนุงููุฉ ุงูุงุฎุชุจุงุฑ
            document.getElementById('preview-test').addEventListener('click', previewTest);
            
            // ุชุตุฏูุฑ ุงูุงุฎุชุจุงุฑ
            document.getElementById('export-test').addEventListener('click', exportTest);
            
            // ุงุณุชูุฑุงุฏ ุงูุงุฎุชุจุงุฑ
            document.getElementById('import-test').addEventListener('click', importTest);
            
            // ุงุณุชูุฑุงุฏ ุงูุทูุงุจ
            document.getElementById('import-students-btn').addEventListener('click', importStudents);
            
            // ุชุญููู ูููุฐุฌ CSV
            document.getElementById('download-template').addEventListener('click', downloadTemplate);
            
            // ุญุฐู ุงูุทูุงุจ
            document.getElementById('clear-students').addEventListener('click', clearStudents);
            
            // ุชุตุฏูุฑ ุงููุชุงุฆุฌ
            document.getElementById('export-results').addEventListener('click', exportResults);
            
            // ุญุฐู ุงููุชุงุฆุฌ
            document.getElementById('clear-results').addEventListener('click', clearResults);
            
            // ุชูููุฏ ุจูุงูุงุช ุงูุชุตุฏูุฑ
            document.getElementById('generate-export').addEventListener('click', generateExportData);
            
            // ุชูููุฐ ุงูุงุณุชูุฑุงุฏ
            document.getElementById('execute-import').addEventListener('click', executeImportData);
        }
        
        // ุชููุฆุฉ ุงูุชุจููุจุงุช
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // ุฅุฒุงูุฉ ุงููุดุงุท ูู ุฌููุน ุงูุชุจููุจุงุช
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // ุฅุถุงูุฉ ุงููุดุงุท ููุชุจููุจ ุงููุญุฏุฏ
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // ุฅุถุงูุฉ ุงูุณุคุงู ุงูุฃูู
        function addFirstQuestion() {
            addQuestion();
        }
        
        // ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ
        function addQuestion() {
            const questionsContainer = document.getElementById('questions-container');
            const questionTemplate = document.getElementById('question-template');
            const questionElement = questionTemplate.content.cloneNode(true);
            
            const questionCount = questionsContainer.children.length + 1;
            const questionDiv = questionElement.querySelector('.question-item');
            questionDiv.setAttribute('data-question-id', questionCount);
            
            // ุชุญุฏูุซ ุฑูู ุงูุณุคุงู
            questionDiv.querySelector('.question-number').textContent = questionCount;
            
            // ุชุญุฏูุซ ูุนุฑูู ุญูู ุงูููุงุท
            const pointsInput = questionDiv.querySelector('.question-points-input');
            pointsInput.id = `points-${questionCount}`;
            
            // ุชุญุฏูุซ ูุต ุนุฑุถ ุงูููุงุท
            questionDiv.querySelector('.question-points').textContent = `${pointsInput.value} ููุทุฉ`;
            
            // ุชุญุฏูุซ ุนุฑุถ ุงูููุงุท ุนูุฏ ุชุบููุฑ ุงููููุฉ
            pointsInput.addEventListener('input', function() {
                questionDiv.querySelector('.question-points').textContent = `${this.value} ููุทุฉ`;
            });
            
            // ุฅุถุงูุฉ ุญุฏุซ ูุญุฐู ุงูุณุคุงู
            questionDiv.querySelector('.delete-question').addEventListener('click', function() {
                if (questionsContainer.children.length > 1) {
                    questionDiv.remove();
                    renumberQuestions();
                } else {
                    showNotification('ูุฌุจ ุฃู ูุญุชูู ุงูุงุฎุชุจุงุฑ ุนูู ุณุคุงู ูุงุญุฏ ุนูู ุงูุฃูู', 'error');
                }
            });
            
            questionsContainer.appendChild(questionDiv);
        }
        
        // ุฅุนุงุฏุฉ ุชุฑููู ุงูุฃุณุฆูุฉ ุจุนุฏ ุงูุญุฐู
        function renumberQuestions() {
            const questions = document.querySelectorAll('.question-item');
            questions.forEach((question, index) => {
                const questionNumber = index + 1;
                question.setAttribute('data-question-id', questionNumber);
                question.querySelector('.question-number').textContent = questionNumber;
                
                // ุชุญุฏูุซ ูุนุฑูู ุญูู ุงูููุงุท
                const pointsInput = question.querySelector('.question-points-input');
                pointsInput.id = `points-${questionNumber}`;
            });
        }
        
        // ุญูุธ ุงูุงุฎุชุจุงุฑ
        function saveTest() {
            const testTitle = document.getElementById('test-title').value.trim();
            if (!testTitle) {
                showNotification('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนููุงู ููุงุฎุชุจุงุฑ', 'error');
                return;
            }
            
            const questions = collectQuestionsData();
            if (questions.length === 0) {
                showNotification('ุงูุฑุฌุงุก ุฅุถุงูุฉ ุฃุณุฆูุฉ ููุงุฎุชุจุงุฑ', 'error');
                return;
            }
            
            // ุงูุญุตูู ุนูู ุงูุชูุงุฑูุฎ
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            // ุงูุชุญูู ูู ุตุญุฉ ุงูุชูุงุฑูุฎ
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                if (end <= start) {
                    showNotification('ุชุงุฑูุฎ ุงูููุงูุฉ ูุฌุจ ุฃู ูููู ุจุนุฏ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ', 'error');
                    return;
                }
            }
            
            // ุฅูุดุงุก ูุงุฆู ุงูุงุฎุชุจุงุฑ
            currentTest = {
                id: generateTestId(),
                title: testTitle,
                description: document.getElementById('test-description').value.trim(),
                questions: questions,
                settings: {
                    autoCorrect: document.getElementById('auto-correct').checked,
                    passingScore: parseInt(document.getElementById('passing-score').value),
                    maxAttempts: parseInt(document.getElementById('max-attempts').value),
                    startDate: startDate,
                    endDate: endDate
                },
                createdAt: new Date().toISOString(),
                teacherAnswers: generateAnswerKey(questions)
            };
            
            // ุญูุธ ุงูุงุฎุชุจุงุฑ ูู ุงูุชุฎุฒูู ุงููุญูู
            savedTests[currentTest.id] = currentTest;
            localStorage.setItem('teacher_tests', JSON.stringify(savedTests));
            
            // ุฅูุดุงุก ุฑุงุจุท ุงูุงุฎุชุจุงุฑ
            const testLink = `${window.location.origin}${window.location.pathname.replace('teacher.html', '')}student.html`;
            
            // ุนุฑุถ ุฑุงุจุท ุงูุงุฎุชุจุงุฑ
            document.getElementById('test-link').textContent = testLink;
            document.getElementById('test-link-container').style.display = 'block';
            
            showNotification('ุชู ุญูุธ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ! ููููู ุงูุขู ูุดุงุฑูุฉ ุงูุฑุงุจุท ูุน ุงูุทูุงุจ');
            
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช
            loadTestsList();
        }
        
        // ุฌูุน ุจูุงูุงุช ุงูุฃุณุฆูุฉ
        function collectQuestionsData() {
            const questions = [];
            const questionElements = document.querySelectorAll('.question-item');
            
            questionElements.forEach((questionElement, index) => {
                const questionText = questionElement.querySelector('.question-text').value.trim();
                if (!questionText) return;
                
                const question = {
                    id: index + 1,
                    text: questionText,
                    options: {
                        a: questionElement.querySelector('.option-a').value.trim(),
                        b: questionElement.querySelector('.option-b').value.trim(),
                        c: questionElement.querySelector('.option-c').value.trim(),
                        d: questionElement.querySelector('.option-d').value.trim()
                    },
                    correctAnswer: questionElement.querySelector('.correct-option').value,
                    points: parseInt(questionElement.querySelector('.question-points-input').value)
                };
                
                // ุงูุชุญูู ูู ุงูุชูุงู ุงูุจูุงูุงุช
                if (question.options.a && question.options.b && question.options.c && question.options.d) {
                    questions.push(question);
                }
            });
            
            return questions;
        }
        
        // ุฅูุดุงุก ููุชุงุญ ุงูุฅุฌุงุจุงุช ูููุนูู
        function generateAnswerKey(questions) {
            const answerKey = {};
            questions.forEach(question => {
                answerKey[question.id] = {
                    correctAnswer: question.correctAnswer,
                    points: question.points
                };
            });
            return answerKey;
        }
        
        // ุฅูุดุงุก ูุนุฑูู ูุฑูุฏ ููุงุฎุชุจุงุฑ
        function generateTestId() {
            return 'test_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // ูุนุงููุฉ ุงูุงุฎุชุจุงุฑ
        function previewTest() {
            const questions = collectQuestionsData();
            if (questions.length === 0) {
                showNotification('ุงูุฑุฌุงุก ุฅุถุงูุฉ ุฃุณุฆูุฉ ุฃููุงู', 'error');
                return;
            }
            
            // ุญูุธ ุงูุงุฎุชุจุงุฑ ูุคูุชุงู ูููุนุงููุฉ
            const tempTest = {
                id: 'preview',
                title: document.getElementById('test-title').value.trim() || 'ูุนุงููุฉ ุงูุงุฎุชุจุงุฑ',
                questions: questions,
                settings: {
                    maxAttempts: 2
                }
            };
            
            localStorage.setItem('preview_test', JSON.stringify(tempTest));
            
            // ูุชุญ ุตูุญุฉ ุงููุนุงููุฉ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ
            window.open(`student.html?test=preview&preview=true`, '_blank');
        }
        
        // ุชุตุฏูุฑ ุงูุงุฎุชุจุงุฑ
        function exportTest() {
            const questions = collectQuestionsData();
            if (questions.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุตุฏูุฑ', 'error');
                return;
            }
            
            const testData = {
                title: document.getElementById('test-title').value.trim() || 'ุงุฎุชุจุงุฑ ุจุฏูู ุนููุงู',
                description: document.getElementById('test-description').value.trim(),
                questions: questions,
                settings: {
                    autoCorrect: document.getElementById('auto-correct').checked,
                    passingScore: parseInt(document.getElementById('passing-score').value),
                    maxAttempts: parseInt(document.getElementById('max-attempts').value),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value
                },
                exportDate: new Date().toISOString()
            };
            
            const exportJson = JSON.stringify(testData, null, 2);
            
            // ุฅูุดุงุก ููู ููุชุญููู
            const blob = new Blob([exportJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test_export_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ุชู ุชุตุฏูุฑ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ');
        }
        
        // ุงุณุชูุฑุงุฏ ุงูุงุฎุชุจุงุฑ
        function importTest() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // ุชุนุจุฆุฉ ุงูุจูุงูุงุช ูู ุงููููุฐุฌ
                        document.getElementById('test-title').value = importedData.title || '';
                        document.getElementById('test-description').value = importedData.description || '';
                        
                        // ูุณุญ ุงูุฃุณุฆูุฉ ุงูุญุงููุฉ
                        document.getElementById('questions-container').innerHTML = '';
                        
                        // ุฅุถุงูุฉ ุงูุฃุณุฆูุฉ ุงููุณุชูุฑุฏุฉ
                        if (importedData.questions && importedData.questions.length > 0) {
                            importedData.questions.forEach((question, index) => {
                                addQuestion();
                                
                                // ุงูุญุตูู ุนูู ุขุฎุฑ ุณุคุงู ูุถุงู
                                const questionElements = document.querySelectorAll('.question-item');
                                const lastQuestion = questionElements[questionElements.length - 1];
                                
                                // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุณุคุงู
                                lastQuestion.querySelector('.question-text').value = question.text || '';
                                lastQuestion.querySelector('.option-a').value = question.options.a || '';
                                lastQuestion.querySelector('.option-b').value = question.options.b || '';
                                lastQuestion.querySelector('.option-c').value = question.options.c || '';
                                lastQuestion.querySelector('.option-d').value = question.options.d || '';
                                lastQuestion.querySelector('.correct-option').value = question.correctAnswer || 'a';
                                lastQuestion.querySelector('.question-points-input').value = question.points || 1;
                                lastQuestion.querySelector('.question-points').textContent = `${question.points || 1} ููุทุฉ`;
                            });
                        }
                        
                        // ุชุนุจุฆุฉ ุงูุฅุนุฏุงุฏุงุช
                        if (importedData.settings) {
                            document.getElementById('auto-correct').checked = importedData.settings.autoCorrect !== false;
                            document.getElementById('passing-score').value = importedData.settings.passingScore || 60;
                            document.getElementById('max-attempts').value = importedData.settings.maxAttempts || 2;
                            document.getElementById('start-date').value = importedData.settings.startDate || '';
                            document.getElementById('end-date').value = importedData.settings.endDate || '';
                        }
                        
                        showNotification('ุชู ุงุณุชูุฑุงุฏ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ');
                    } catch (error) {
                        showNotification('ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงูููู. ุชุฃูุฏ ูู ุตุญุฉ ุชูุณูู JSON', 'error');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ุงุณุชูุฑุงุฏ ูุงุฆูุฉ ุงูุทูุงุจ ูู ููู CSV
        function importStudents() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.txt';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const csvData = event.target.result;
                        const students = parseCSV(csvData);
                        
                        if (students.length === 0) {
                            showNotification('ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุทูุงุจ ูู ุงูููู', 'error');
                            return;
                        }
                        
                        // ุญูุธ ูุงุฆูุฉ ุงูุทูุงุจ
                        studentsList = students.reduce((acc, student) => {
                            if (student.id && student.name) {
                                acc[student.id] = student.name;
                            }
                            return acc;
                        }, {});
                        
                        localStorage.setItem('students_list', JSON.stringify(studentsList));
                        
                        // ุนุฑุถ ูุงุฆูุฉ ุงูุทูุงุจ
                        loadStudentsList();
                        
                        showNotification(`ุชู ุงุณุชูุฑุงุฏ ${Object.keys(studentsList).length} ุทุงูุจ ุจูุฌุงุญ`);
                    } catch (error) {
                        showNotification('ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงูููู. ุชุฃูุฏ ูู ุตุญุฉ ุชูุณูู CSV', 'error');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ุชุญููู ุจูุงูุงุช CSV
        function parseCSV(csvData) {
            const students = [];
            const lines = csvData.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // ุชูุณูู ุงูุณุทุฑ ุจุงุณุชุฎุฏุงู ุงููุงุตูุฉ
                const parts = line.split(',');
                
                if (parts.length >= 2) {
                    const studentId = parts[0].trim();
                    const studentName = parts[1].trim();
                    
                    if (studentId && studentName) {
                        students.push({
                            id: studentId,
                            name: studentName
                        });
                    }
                }
            }
            
            return students;
        }
        
        // ุชุญููู ูููุฐุฌ ููู CSV
        function downloadTemplate() {
            const template = "ุฑูู_ุงูุทุงูุจ,ุงุณู_ุงูุทุงูุจ\n123456,ุฃุญูุฏ ูุญูุฏ\n654321,ุณุงุฑุฉ ุนุจุฏุงููู\n789012,ุฎุงูุฏ ุณุงูู";
            
            const blob = new Blob([template], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ูููุฐุฌ_ูุงุฆูุฉ_ุงูุทูุงุจ.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ุชู ุชุญููู ูููุฐุฌ ููู CSV');
        }
        
        // ุชุญููู ูุงุฆูุฉ ุงูุทูุงุจ
        function loadStudentsList() {
            const container = document.getElementById('students-list');
            const noStudents = document.getElementById('no-students');
            
            if (!studentsList || Object.keys(studentsList).length === 0) {
                noStudents.style.display = 'block';
                container.style.display = 'none';
                container.innerHTML = '';
                return;
            }
            
            noStudents.style.display = 'none';
            container.style.display = 'block';
            
            let html = '';
            let count = 1;
            
            for (const studentId in studentsList) {
                html += `
                    <div class="student-item">
                        <div>
                            <strong>${count}.</strong> ${studentsList[studentId]}
                            <br><small style="color: #666;">ุฑูู ุงูุณุฌู: ${studentId}</small>
                        </div>
                        <div>
                            <button class="btn btn-danger btn-sm delete-student" data-id="${studentId}" style="padding: 5px 10px; font-size: 12px;">ุญุฐู</button>
                        </div>
                    </div>
                `;
                count++;
            }
            
            container.innerHTML = html;
            
            // ุฅุถุงูุฉ ุฃุญุฏุงุซ ูุญุฐู ุงูุทูุงุจ
            container.querySelectorAll('.delete-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    deleteStudent(studentId);
                });
            });
        }
        
        // ุญุฐู ุทุงูุจ
        function deleteStudent(studentId) {
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุทุงูุจ ${studentsList[studentId]}ุ`)) {
                delete studentsList[studentId];
                localStorage.setItem('students_list', JSON.stringify(studentsList));
                loadStudentsList();
                showNotification('ุชู ุญุฐู ุงูุทุงูุจ ุจูุฌุงุญ');
            }
        }
        
        // ุญุฐู ุฌููุน ุงูุทูุงุจ
        function clearStudents() {
            if (Object.keys(studentsList).length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุทูุงุจ ูุญุฐููุง', 'warning');
                return;
            }
            
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุทูุงุจ (${Object.keys(studentsList).length} ุทุงูุจ)ุ`)) {
                studentsList = {};
                localStorage.removeItem('students_list');
                loadStudentsList();
                showNotification('ุชู ุญุฐู ุฌููุน ุงูุทูุงุจ ุจูุฌุงุญ');
            }
        }
        
        // ุชุญููู ูุชุงุฆุฌ ุงูุทูุงุจ
        function loadResults() {
            const resultsBody = document.getElementById('results-body');
            resultsBody.innerHTML = '';
            
            if (!testResults || Object.keys(testResults).length === 0) {
                document.getElementById('no-results').style.display = 'block';
                document.getElementById('results-table').style.display = 'none';
                document.getElementById('results-actions').style.display = 'none';
                return;
            }
            
            // ุนุฑุถ ุงููุชุงุฆุฌ
            let hasResults = false;
            
            for (const testId in testResults) {
                const testData = testResults[testId];
                
                if (testData && testData.submissions && testData.submissions.length > 0) {
                    hasResults = true;
                    
                    testData.submissions.forEach(submission => {
                        const row = document.createElement('tr');
                        
                        const testInfo = savedTests[testId];
                        const testTitle = testInfo ? testInfo.title : `ุงุฎุชุจุงุฑ ${testId.substring(0, 8)}`;
                        const percentage = submission.totalPoints > 0 ? Math.round((submission.score / submission.totalPoints) * 100) : 0;
                        const isPassing = percentage >= (testInfo?.settings?.passingScore || 60);
                        const maxAttempts = testInfo?.settings?.maxAttempts || 2;
                        const attemptsUsed = submission.attempts || 1;
                        const remainingAttempts = maxAttempts - attemptsUsed;
                        
                        // ุงูุญุตูู ุนูู ุงุณู ุงูุทุงูุจ ูู ูุงุฆูุฉ ุงูุทูุงุจ ุฅุฐุง ูุงู ููุฌูุฏุงู
                        let studentName = submission.studentName;
                        if (studentsList[submission.studentId]) {
                            studentName = studentsList[submission.studentId];
                        }
                        
                        row.innerHTML = `
                            <td>${studentName || 'ุทุงูุจ ุจุฏูู ุงุณู'}</td>
                            <td>${submission.studentId || 'ุจุฏูู'}</td>
                            <td>${testTitle}</td>
                            <td class="student-score">${submission.score}/${submission.totalPoints}</td>
                            <td>${attemptsUsed}/${maxAttempts}</td>
                            <td class="${isPassing ? 'student-pass' : 'student-fail'}">${isPassing ? 'ูุงุฌุญ' : 'ุฑุงุณุจ'}</td>
                            <td>${new Date(submission.submittedAt).toLocaleString('ar-SA')}</td>
                            <td>
                                <button class="btn btn-secondary view-details" data-test="${testId}" data-student="${submission.studentId}">ุชูุงุตูู</button>
                                ${remainingAttempts > 0 ? `<button class="btn btn-success add-attempt" data-test="${testId}" data-student="${submission.studentId}">ุฅุถุงูุฉ ูุญุงููุฉ</button>` : ''}
                            </td>
                        `;
                        
                        resultsBody.appendChild(row);
                    });
                }
            }
            
            if (hasResults) {
                document.getElementById('no-results').style.display = 'none';
                document.getElementById('results-table').style.display = 'table';
                document.getElementById('results-actions').style.display = 'flex';
            } else {
                document.getElementById('no-results').style.display = 'block';
                document.getElementById('results-table').style.display = 'none';
                document.getElementById('results-actions').style.display = 'none';
            }
        }
        
        // ุชุตุฏูุฑ ุงููุชุงุฆุฌ ูููู CSV
        function exportResults() {
            if (!testResults || Object.keys(testResults).length === 0) {
                showNotification('ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุชุตุฏูุฑ', 'error');
                return;
            }
            
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // ุนููุงู CSV
            csvContent += "ุงุณู ุงูุทุงูุจ,ุฑูู ุงูุณุฌู,ุงูุงุฎุชุจุงุฑ,ุงูุฏุฑุฌุฉ,ุงููุณุจุฉ,ุงููุญุงููุงุช,ุงูุญุงูุฉ,ุชุงุฑูุฎ ุงูุฅุฑุณุงู\n";
            
            // ุจูุงูุงุช ุงููุชุงุฆุฌ
            for (const testId in testResults) {
                const testData = testResults[testId];
                
                if (testData && testData.submissions && testData.submissions.length > 0) {
                    const testTitle = savedTests[testId] ? savedTests[testId].title : `ุงุฎุชุจุงุฑ ${testId.substring(0, 8)}`;
                    const maxAttempts = savedTests[testId]?.settings?.maxAttempts || 2;
                    
                    testData.submissions.forEach(submission => {
                        // ุงูุญุตูู ุนูู ุงุณู ุงูุทุงูุจ ูู ูุงุฆูุฉ ุงูุทูุงุจ ุฅุฐุง ูุงู ููุฌูุฏุงู
                        let studentName = submission.studentName;
                        if (studentsList[submission.studentId]) {
                            studentName = studentsList[submission.studentId];
                        }
                        
                        const percentage = submission.totalPoints > 0 ? Math.round((submission.score / submission.totalPoints) * 100) : 0;
                        const isPassing = percentage >= (savedTests[testId]?.settings?.passingScore || 60);
                        const status = isPassing ? "ูุงุฌุญ" : "ุฑุงุณุจ";
                        const date = new Date(submission.submittedAt).toLocaleDateString('ar-SA');
                        const attemptsUsed = submission.attempts || 1;
                        
                        csvContent += `"${studentName || 'ุทุงูุจ ุจุฏูู ุงุณู'}","${submission.studentId || ''}","${testTitle}",${submission.score}/${submission.totalPoints},${percentage}%,${attemptsUsed}/${maxAttempts},${status},"${date}"\n`;
                    });
                }
            }
            
            // ุชุญููู ุงูููู
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `ูุชุงุฆุฌ_ุงูุทูุงุจ_${Date.now()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ุชู ุชุตุฏูุฑ ุงููุชุงุฆุฌ ุจูุฌุงุญ');
        }
        
        // ุญุฐู ุฌููุน ุงููุชุงุฆุฌ
        function clearResults() {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ูุชุงุฆุฌ ุงูุทูุงุจุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.')) {
                testResults = {};
                localStorage.removeItem('test_results');
                loadResults();
                showNotification('ุชู ุญุฐู ุฌููุน ุงููุชุงุฆุฌ');
            }
        }
        
        // ุชุญููู ูุงุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช ุงููุฎุฒูุฉ
        function loadTestsList() {
            const testsList = document.getElementById('tests-list');
            testsList.innerHTML = '';
            
            if (!savedTests || Object.keys(savedTests).length === 0) {
                testsList.innerHTML = `
                    <div class="empty-state">
                        <div>๐</div>
                        <p>ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช ูุฎุฒูุฉ ุจุนุฏ</p>
                        <p>ูู ุจุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ ูุญูุธู ููุง</p>
                    </div>
                `;
                return;
            }
            
            let testsHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
            
            for (const testId in savedTests) {
                const test = savedTests[testId];
                const questionCount = test.questions ? test.questions.length : 0;
                const submissionCount = testResults[testId] ? testResults[testId].submissions.length : 0;
                const date = new Date(test.createdAt).toLocaleDateString('ar-SA');
                const maxAttempts = test.settings?.maxAttempts || 2;
                const startDate = test.settings?.startDate ? new Date(test.settings.startDate).toLocaleString('ar-SA') : 'ุบูุฑ ูุญุฏุฏ';
                const endDate = test.settings?.endDate ? new Date(test.settings.endDate).toLocaleString('ar-SA') : 'ุบูุฑ ูุญุฏุฏ';
                
                testsHTML += `
                    <div style="background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
                        <h3 style="margin-top: 0; color: #2c3e6e;">${test.title}</h3>
                        <p>${test.description || 'ุจุฏูู ูุตู'}</p>
                        <div style="display: flex; justify-content: space-between; margin-top: 15px; color: #666;">
                            <span>${questionCount} ุฃุณุฆูุฉ</span>
                            <span>${maxAttempts} ูุญุงููุงุช</span>
                            <span>${submissionCount} ุฅุฌุงุจุงุช</span>
                        </div>
                        <div style="margin-top: 10px; font-size: 14px; color: #888;">
                            <div><strong>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ:</strong> ${startDate}</div>
                            <div><strong>ุชุงุฑูุฎ ุงูููุงูุฉ:</strong> ${endDate}</div>
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #888;">ุฃูุดุฆ ูู: ${date}</div>
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-secondary load-test-btn" data-test="${testId}" style="padding: 8px 15px; font-size: 14px;">ุชุญููู</button>
                            <button class="btn btn-danger delete-test-btn" data-test="${testId}" style="padding: 8px 15px; font-size: 14px;">ุญุฐู</button>
                        </div>
                    </div>
                `;
            }
            
            testsHTML += '</div>';
            testsList.innerHTML = testsHTML;
            
            // ุฅุถุงูุฉ ุฃุญุฏุงุซ ูุฃุฒุฑุงุฑ ุงูุชุญูู
            document.querySelectorAll('.load-test-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const testId = this.getAttribute('data-test');
                    loadTestToForm(testId);
                });
            });
            
            document.querySelectorAll('.delete-test-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const testId = this.getAttribute('data-test');
                    deleteTest(testId);
                });
            });
        }
        
        // ุชุญููู ุงุฎุชุจุงุฑ ุฅูู ูููุฐุฌ ุงูุชุญุฑูุฑ
        function loadTestToForm(testId) {
            const test = savedTests[testId];
            if (!test) return;
            
            // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ
            document.getElementById('test-title').value = test.title || '';
            document.getElementById('test-description').value = test.description || '';
            
            if (test.settings) {
                document.getElementById('auto-correct').checked = test.settings.autoCorrect !== false;
                document.getElementById('passing-score').value = test.settings.passingScore || 60;
                document.getElementById('max-attempts').value = test.settings.maxAttempts || 2;
                document.getElementById('start-date').value = test.settings.startDate || '';
                document.getElementById('end-date').value = test.settings.endDate || '';
            }
            
            // ูุณุญ ุงูุฃุณุฆูุฉ ุงูุญุงููุฉ
            document.getElementById('questions-container').innerHTML = '';
            
            // ุฅุถุงูุฉ ุฃุณุฆูุฉ ุงูุงุฎุชุจุงุฑ
            if (test.questions && test.questions.length > 0) {
                test.questions.forEach((question, index) => {
                    addQuestion();
                    
                    // ุงูุญุตูู ุนูู ุขุฎุฑ ุณุคุงู ูุถุงู
                    const questionElements = document.querySelectorAll('.question-item');
                    const lastQuestion = questionElements[questionElements.length - 1];
                    
                    // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุณุคุงู
                    lastQuestion.querySelector('.question-text').value = question.text || '';
                    lastQuestion.querySelector('.option-a').value = question.options.a || '';
                    lastQuestion.querySelector('.option-b').value = question.options.b || '';
                    lastQuestion.querySelector('.option-c').value = question.options.c || '';
                    lastQuestion.querySelector('.option-d').value = question.options.d || '';
                    lastQuestion.querySelector('.correct-option').value = question.correctAnswer || 'a';
                    lastQuestion.querySelector('.question-points-input').value = question.points || 1;
                    lastQuestion.querySelector('.question-points').textContent = `${question.points || 1} ููุทุฉ`;
                });
            }
            
            // ุงูุงูุชูุงู ุฅูู ุชุจููุจ ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ
            document.querySelector('[data-tab="create-test"]').click();
            
            showNotification('ุชู ุชุญููู ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ');
        }
        
        // ุญุฐู ุงุฎุชุจุงุฑ
        function deleteTest(testId) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุงุฎุชุจุงุฑุ ุณูุชู ุญุฐู ุฌููุน ุงููุชุงุฆุฌ ุงููุฑุชุจุทุฉ ุจู ุฃูุถุงู.')) {
                delete savedTests[testId];
                localStorage.setItem('teacher_tests', JSON.stringify(savedTests));
                
                // ุญุฐู ุงููุชุงุฆุฌ ุงููุฑุชุจุทุฉ ุจูุฐุง ุงูุงุฎุชุจุงุฑ
                if (testResults[testId]) {
                    delete testResults[testId];
                    localStorage.setItem('test_results', JSON.stringify(testResults));
                    loadResults();
                }
                
                loadTestsList();
                showNotification('ุชู ุญุฐู ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ');
            }
        }
        
        // ุชูููุฏ ุจูุงูุงุช ุงูุชุตุฏูุฑ ุงููุงููุฉ
        function generateExportData() {
            const exportData = {
                tests: savedTests,
                results: testResults,
                students: studentsList,
                exportDate: new Date().toISOString(),
                version: "1.0"
            };
            
            const exportJson = JSON.stringify(exportData, null, 2);
            document.getElementById('export-data').value = exportJson;
            
            showNotification('ุชู ุชูููุฏ ุจูุงูุงุช ุงูุชุตุฏูุฑ');
        }
        
        // ุชูููุฐ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
        function executeImportData() {
            const importJson = document.getElementById('import-data').value.trim();
            
            if (!importJson) {
                showNotification('ุงูุฑุฌุงุก ูุตู ุจูุงูุงุช ุงูุงุณุชูุฑุงุฏ ุฃููุงู', 'error');
                return;
            }
            
            try {
                const importedData = JSON.parse(importJson);
                
                if (importedData.tests) {
                    // ุฏูุฌ ุงูุงุฎุชุจุงุฑุงุช ุงููุณุชูุฑุฏุฉ ูุน ุงูุญุงููุฉ
                    Object.assign(savedTests, importedData.tests);
                    localStorage.setItem('teacher_tests', JSON.stringify(savedTests));
                }
                
                if (importedData.results) {
                    // ุฏูุฌ ุงููุชุงุฆุฌ ุงููุณุชูุฑุฏุฉ ูุน ุงูุญุงููุฉ
                    Object.assign(testResults, importedData.results);
                    localStorage.setItem('test_results', JSON.stringify(testResults));
                    loadResults();
                }
                
                if (importedData.students) {
                    // ุฏูุฌ ูุงุฆูุฉ ุงูุทูุงุจ ุงููุณุชูุฑุฏุฉ ูุน ุงูุญุงููุฉ
                    Object.assign(studentsList, importedData.students);
                    localStorage.setItem('students_list', JSON.stringify(studentsList));
                    loadStudentsList();
                }
                
                loadTestsList();
                showNotification('ุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุจูุฌุงุญ');
                document.getElementById('import-data').value = '';
            } catch (error) {
                showNotification('ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช. ุชุฃูุฏ ูู ุตุญุฉ ุชูุณูู JSON', 'error');
                console.error(error);
            }
        }
        
        // ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
    </script>
</body>

</html>
